# gdtools

The package `gdtools` provides font metric calculation and font
management tools for R packages that produce graphical or tabular
outputs. It is used by packages ‘flextable’, ‘ggiraph’, ‘rvg’.

## Background

`gdtools` was originally designed to compute font metrics for R graphic
devices via C-level interfaces (Cairo and FreeType). With the arrival of
the ‘systemfonts’ package, font discovery and matching became much
simpler and the C interface was no longer needed by other packages.

The package has since been refocused: it still relies on Cairo for
device-independent text measurement, but delegates font resolution to
‘systemfonts’. Its role is now entirely at the R level – providing
accurate text metrics and making it easy to work with additional fonts
(Google Fonts, Liberation fonts) so that outputs look the same across
platforms.

## Installation

You can install the released version of gdtools from CRAN with:

``` r
install.packages("gdtools")
```

And the development version from GitHub with:

``` r
# install.packages("remotes")
remotes::install_github("davidgohel/gdtools")
```

## Font metrics

The main function for text measurement is
[`strings_sizes()`](https://davidgohel.github.io/gdtools/dev/reference/strings_sizes.md).
It returns width, ascent and descent in inches using Cairo text
measurement directly.

``` r
library(gdtools)
strings_sizes(
  c("a string", "a longer string"),
  fontsize = 24, 
  bold = TRUE, 
  italic = TRUE
)
#>      width    ascent    descent
#> 1 1.203939 0.2413737 0.07259115
#> 2 2.315104 0.2413737 0.07259115
```

All arguments are vectorized:

``` r
strings_sizes(
  c("normal", "bold", "italic", "bold-italic"),
  fontsize = 12,
  bold = c(FALSE, TRUE, FALSE, TRUE),
  italic = c(FALSE, FALSE, TRUE, TRUE)
)
#>       width    ascent     descent
#> 1 0.5094401 0.1195475 0.003173828
#> 2 0.3517253 0.1199544 0.003092448
#> 3 0.3334147 0.1195475 0.002929688
#> 4 0.7870280 0.1206868 0.003092448
```

## Font management

### Google Fonts

A set of functions is provided to download and cache fonts from ‘Google
Fonts’. They can be used in ‘R Markdown’ documents and ‘Shiny’
applications, as well as with graphic outputs generated by ‘ggiraph’,
‘ragg’ and ‘svglite’, or tabular outputs from ‘flextable’.

``` r
# Download and register with systemfonts (cached for future use)
register_gfont(family = "Open Sans")
```

Use
[`addGFontHtmlDependency()`](https://davidgohel.github.io/gdtools/dev/reference/addGFontHtmlDependency.md)
to embed a Google Font in an HTML document, and
[`gfontHtmlDependency()`](https://davidgohel.github.io/gdtools/dev/reference/gfontHtmlDependency.md)
to create an `htmltools` dependency object.

To install a Google Font at the system level (e.g. in a Dockerfile), use
[`install_gfont_script()`](https://davidgohel.github.io/gdtools/dev/reference/install_gfont_script.md):

``` r
install_gfont_script("Fira Sans", platform = "debian", file = "install-font.sh")
```

### Liberation fonts

The package bundles ‘Liberation Sans’, ‘Liberation Serif’ and
‘Liberation Mono’ fonts. They are useful as cross-platform fallback
fonts, for visual tests, or when no internet connection is available.

``` r
register_liberationsans()
register_liberationserif()
register_liberationmono()
```

The corresponding
[`liberationsansHtmlDependency()`](https://davidgohel.github.io/gdtools/dev/reference/liberationsansHtmlDependency.md),
[`liberationserifHtmlDependency()`](https://davidgohel.github.io/gdtools/dev/reference/liberationserifHtmlDependency.md)
and
[`liberationmonoHtmlDependency()`](https://davidgohel.github.io/gdtools/dev/reference/liberationmonoHtmlDependency.md)
functions provide HTML dependencies for use in Shiny or R Markdown.

# Package index

## All functions

- [`addGFontHtmlDependency()`](https://davidgohel.github.io/gdtools/dev/reference/addGFontHtmlDependency.md)
  : Use a Font in Shiny or Markdown
- [`font_family_exists()`](https://davidgohel.github.io/gdtools/dev/reference/font_family_exists.md)
  : Check if font family exists.
- [`fonts_cache_dir()`](https://davidgohel.github.io/gdtools/dev/reference/fonts_cache_dir.md)
  [`rm_fonts_cache()`](https://davidgohel.github.io/gdtools/dev/reference/fonts_cache_dir.md)
  [`init_fonts_cache()`](https://davidgohel.github.io/gdtools/dev/reference/fonts_cache_dir.md)
  : Manage Font Working Directory
- [`gfontHtmlDependency()`](https://davidgohel.github.io/gdtools/dev/reference/gfontHtmlDependency.md)
  : 'Google Font' HTML dependency
- [`install_gfont_script()`](https://davidgohel.github.io/gdtools/dev/reference/install_gfont_script.md)
  : Shell command to install a font from 'Google Fonts'
- [`installed_gfonts()`](https://davidgohel.github.io/gdtools/dev/reference/installed_gfonts.md)
  : List installed 'Google Fonts'
- [`liberationmonoHtmlDependency()`](https://davidgohel.github.io/gdtools/dev/reference/liberationmonoHtmlDependency.md)
  : 'Liberation Mono' Font HTML dependency
- [`liberationsansHtmlDependency()`](https://davidgohel.github.io/gdtools/dev/reference/liberationsansHtmlDependency.md)
  : 'Liberation Sans' Font HTML dependency
- [`liberationserifHtmlDependency()`](https://davidgohel.github.io/gdtools/dev/reference/liberationserifHtmlDependency.md)
  : 'Liberation Serif' Font HTML dependency
- [`m_str_extents()`](https://davidgohel.github.io/gdtools/dev/reference/m_str_extents.md)
  : Compute string extents for a vector of strings.
- [`match_family()`](https://davidgohel.github.io/gdtools/dev/reference/match_family.md)
  : Find best family match with systemfonts
- [`register_gfont()`](https://davidgohel.github.io/gdtools/dev/reference/register_gfont.md)
  : Register a 'Google Font'
- [`register_liberationmono()`](https://davidgohel.github.io/gdtools/dev/reference/register_liberationmono.md)
  : Register font 'Liberation Mono'
- [`register_liberationsans()`](https://davidgohel.github.io/gdtools/dev/reference/register_liberationsans.md)
  : Register font 'Liberation Sans'
- [`register_liberationserif()`](https://davidgohel.github.io/gdtools/dev/reference/register_liberationserif.md)
  : Register font 'Liberation Serif'
- [`str_metrics()`](https://davidgohel.github.io/gdtools/dev/reference/str_metrics.md)
  : Get font metrics for a string.
- [`strings_sizes()`](https://davidgohel.github.io/gdtools/dev/reference/strings_sizes.md)
  : Compute strings sizes
- [`sys_fonts()`](https://davidgohel.github.io/gdtools/dev/reference/sys_fonts.md)
  : List fonts for 'systemfonts'.
- [`version_freetype()`](https://davidgohel.github.io/gdtools/dev/reference/version_cairo.md)
  [`version_cairo()`](https://davidgohel.github.io/gdtools/dev/reference/version_cairo.md)
  : Version numbers of C libraries

