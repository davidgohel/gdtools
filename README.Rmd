---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# gdtools

<!-- badges: start -->
[![CRAN status](https://www.r-pkg.org/badges/version/gdtools)](https://CRAN.R-project.org/package=gdtools)
[![R build status](https://github.com/davidgohel/gdtools/workflows/R-CMD-check/badge.svg)](https://github.com/davidgohel/gdtools/actions)
[![codecov test coverage](https://codecov.io/gh/davidgohel/gdtools/branch/master/graph/badge.svg)](https://app.codecov.io/gh/davidgohel/gdtools)
<!-- badges: end -->

The package `gdtools` provides font metric calculation and font management
tools for R packages that produce graphical or tabular outputs. It is used
by packages 'flextable', 'ggiraph', 'rvg'.

## Background

`gdtools` was originally designed to compute font metrics for R graphic
devices via C-level interfaces (Cairo and FreeType). With the arrival of the
'systemfonts' package, font discovery and matching became much simpler and
the C interface was no longer needed by other packages.

The package has since been refocused: it still relies on Cairo for
device-independent text measurement, but delegates font resolution to
'systemfonts'. Its role is now entirely at the R level -- providing accurate
text metrics and making it easy to work with additional fonts (Google Fonts,
Liberation fonts) so that outputs look the same across platforms.

## Installation

You can install the released version of gdtools from CRAN with:

``` r
install.packages("gdtools")
```

And the development version from GitHub with:

``` r
# install.packages("remotes")
remotes::install_github("davidgohel/gdtools")
```

## Font metrics

The main function for text measurement is `strings_sizes()`. It returns
width, ascent and descent in inches using Cairo text measurement directly.

```{r}
library(gdtools)
strings_sizes(
  c("a string", "a longer string"),
  fontsize = 24, 
  bold = TRUE, 
  italic = TRUE
)
```

All arguments are vectorized:

```{r}
strings_sizes(
  c("normal", "bold", "italic", "bold-italic"),
  fontsize = 12,
  bold = c(FALSE, TRUE, FALSE, TRUE),
  italic = c(FALSE, FALSE, TRUE, TRUE)
)
```

## Font management

### Google Fonts

A set of functions is provided to download and cache fonts from
'Google Fonts'. They can be used in 'R Markdown' documents and 'Shiny'
applications, as well as with graphic outputs generated by 'ggiraph',
'ragg' and 'svglite', or tabular outputs from 'flextable'.

```{r eval=FALSE}
# Download and register with systemfonts (cached for future use)
register_gfont(family = "Open Sans")
```

Use `addGFontHtmlDependency()` to embed a Google Font in an HTML document,
and `gfontHtmlDependency()` to create an `htmltools` dependency object.

To install a Google Font at the system level (e.g. in a Dockerfile), use
`install_gfont_script()`:

```{r eval=FALSE}
install_gfont_script("Fira Sans", platform = "debian", file = "install-font.sh")
```

### Liberation fonts

The package bundles 'Liberation Sans', 'Liberation Serif' and 'Liberation Mono'
fonts. They are useful as cross-platform fallback fonts, for visual tests,
or when no internet connection is available.

```{r eval=FALSE}
register_liberationsans()
register_liberationserif()
register_liberationmono()
```

The corresponding `liberationsansHtmlDependency()`, `liberationserifHtmlDependency()`
and `liberationmonoHtmlDependency()` functions provide HTML dependencies
for use in Shiny or R Markdown.
